{"remainingRequest":"/home/desarrollo/Escritorio/unabasev4/node_modules/babel-loader/lib/index.js!/home/desarrollo/Escritorio/unabasev4/node_modules/eslint-loader/index.js??ref--13-0!/home/desarrollo/Escritorio/unabasev4/src/store/modules/users.js","dependencies":[{"path":"/home/desarrollo/Escritorio/unabasev4/src/store/modules/users.js","mtime":1552579294356},{"path":"/home/desarrollo/Escritorio/unabasev4/.babelrc","mtime":1547153504905},{"path":"/home/desarrollo/Escritorio/unabasev4/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/desarrollo/Escritorio/unabasev4/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/desarrollo/Escritorio/unabasev4/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import _typeof from \"/home/desarrollo/Escritorio/unabasev4/node_modules/@babel/runtime-corejs2/helpers/esm/typeof\";\nimport _Promise from \"/home/desarrollo/Escritorio/unabasev4/node_modules/@babel/runtime-corejs2/core-js/promise\";\nimport _JSON$stringify from \"/home/desarrollo/Escritorio/unabasev4/node_modules/@babel/runtime-corejs2/core-js/json/stringify\";\nimport _objectSpread from \"/home/desarrollo/Escritorio/unabasev4/node_modules/@babel/runtime-corejs2/helpers/esm/objectSpread\";\nimport axios from 'axios';\nimport oldApi from '../../config/api';\nimport api from '../../lib/api';\nimport lang from '../../languages'; // import { mapGetters } from 'vuex'\n\nexport default {\n  namespaced: true,\n  state: {\n    users: Object,\n    // user: Object,\n    token: typeof localStorage.getItem('token') !== 'undefined' && localStorage.getItem('token') !== 'undefined' ? localStorage.getItem('token') : '',\n    user: typeof localStorage.getItem('user') !== 'undefined' && localStorage.getItem('user') !== 'undefined' ? JSON.parse(localStorage.getItem('user')) : '',\n    status: ''\n  },\n  mutations: {\n    auth_request: function auth_request(state) {\n      state.status = 'loading';\n    },\n    access_success: function access_success(state, payload) {\n      state.status = 'success';\n      state.user = _objectSpread({}, payload.user);\n      state.token = payload.token;\n    },\n    setUser: function setUser(state, payload) {\n      console.log(state.user);\n\n      if (payload.isObject) {\n        if (state.user.currency) {\n          console.log('etro en si ciurrency');\n          state.user[payload.attr] = payload.value; //JSON.parse(JSON.stringify(payload.value))\n        } else {\n          console.log('etro en no ciurrency');\n          state.user[payload.attr] = payload.value; //JSON.parse(JSON.stringify(payload.value))\n        }\n      } else {\n        if (payload.attr) {\n          state.user[payload.attr] = payload.value;\n        } else {\n          localStorage.setItem('user', _JSON$stringify(payload));\n          state.user = payload;\n        }\n      }\n    },\n    setUsers: function setUsers(state, payload) {\n      state.users = payload;\n    },\n    access_error: function access_error(state) {\n      state.status = 'error';\n    },\n    register_error: function register_error(state) {\n      state.status = 'error';\n    },\n    verify_error: function verify_error(state) {\n      state.status = 'error';\n    },\n    logout: function logout(state) {\n      state.status = '';\n      state.token = '';\n    }\n  },\n  actions: {\n    logout: function logout(_ref) {\n      var commit = _ref.commit;\n      // eslint-disable-next-line\n      return new _Promise(function (resolve, reject) {\n        commit('logout');\n        localStorage.removeItem('token');\n        localStorage.removeItem('user');\n        delete axios.defaults.headers.common['Authorization'];\n        resolve();\n      });\n    },\n    restart: function restart(_ref2, payload) {\n      var commit = _ref2.commit;\n      return new _Promise(function (resolve, reject) {\n        axios.post(api + '/users/restart/' + payload).then(function (res) {\n          resolve(res);\n        }).catch(function (err) {\n          reject(err);\n        });\n      });\n    },\n    setPassword: function setPassword(_ref3, payload) {\n      var commit = _ref3.commit;\n      return new _Promise(function (resolve, reject) {\n        axios.post(\"\".concat(api, \"/auth/password/\") + payload.id, {\n          newPassword: payload.newPassword,\n          restartPassword: true\n        }).then(function (res) {\n          console.warn(res);\n\n          if (res.status === 200) {\n            localStorage.setItem('token', res.data.token);\n            localStorage.setItem('user', _JSON$stringify(res.data.user));\n            axios.defaults.headers.common['Authorization'] = res.data.token;\n            commit('access_success', res.data);\n            console.log('USUARIO -> ', res.data);\n            resolve(res);\n          }\n        }).catch(function (err) {\n          reject(err);\n        });\n      });\n    },\n    register: function register(_ref4, payload) {\n      var commit = _ref4.commit;\n      return new _Promise(function (resolve, reject) {\n        axios.post(api + '/auth/register/', payload).then(function (res) {\n          // commit('register_success', res.data);\n          // localStorage.setItem('token', res.data.token);\n          // localStorage.setItem('user', JSON.stringify(res.data.user));\n          // axios.defaults.headers.common['Authorization'] = res.data.token;\n          resolve(payload.user);\n        }).catch(function (err) {\n          commit('register_error');\n          localStorage.removeItem('token');\n          localStorage.removeItem('user');\n          reject(err);\n        });\n      });\n    },\n    verify: function verify(_ref5, payload) {\n      var commit = _ref5.commit;\n      return new _Promise(function (resolve, reject) {\n        axios.put(api + '/auth/verify/' + payload.id, {\n          hash: payload.hash\n        }).then(function (res) {\n          if (res.status === 200) {\n            localStorage.setItem('token', res.data.token);\n            localStorage.setItem('user', _JSON$stringify(res.data.user));\n            axios.defaults.headers.common['Authorization'] = res.data.token;\n            commit('access_success', res.data); // resolve(res);\n\n            resolve({\n              message: lang.validations.verifyAccount\n            });\n          } // resolve({ message: lang.validations.verifyAccount });\n\n        }).catch(function (err) {\n          commit('verify_error');\n          reject({\n            message: lang.validations.notVerifyAccount\n          });\n        });\n      });\n    },\n    putUser: function putUser(_ref6, payload) {\n      var commit = _ref6.commit;\n      console.log(payload);\n      return new _Promise(function (resolve, reject) {\n        axios.put(api + '/users' + '/' + payload._id, payload).then(function (res) {\n          localStorage.setItem('user', _JSON$stringify(res.data));\n\n          if (payload.businessType && payload.businessType.length <= 0) {\n            commit('setUser', res.data);\n          }\n\n          resolve(res.data);\n        }).catch(function (err) {\n          reject(err);\n        });\n      });\n    },\n    google: function google(_ref7, payload) {\n      var _this = this;\n\n      var commit = _ref7.commit;\n      return new _Promise(function (resolve, reject) {\n        console.log(api + '/auth/google');\n        axios.post(oldApi.auth.google, {\n          token: payload.token,\n          access_token: payload.access_token,\n          google: payload.google\n        }).then(function (data) {\n          localStorage.setItem('token', data.data.token);\n          localStorage.setItem('user', _JSON$stringify(data.data.user));\n          axios.defaults.headers.common['Authorization'] = data.data.token;\n          commit('access_success', data.data);\n\n          _this.commit('currency/SET_CURRENCY', data.data.user.currency);\n\n          _this.dispatch('business/getAllBusiness');\n\n          resolve(payload.user);\n        }).catch(function (err) {\n          commit('access_error');\n          localStorage.removeItem('token');\n          localStorage.removeItem('user');\n          reject(err, err.response);\n        });\n      });\n    },\n    googleNew: function googleNew(_ref8, payload) {\n      var commit = _ref8.commit;\n      return new _Promise(function (resolve, reject) {\n        axios.post(oldApi.auth.google.register, payload.googleUser).then(function (res) {\n          commit('access_success', res.data);\n          localStorage.setItem('token', res.data.token);\n          localStorage.setItem('user', _JSON$stringify(res.data.user));\n          axios.defaults.headers.common['Authorization'] = res.data.token;\n          resolve(payload.user);\n        }).catch(function (err) {\n          commit('access_error');\n          localStorage.removeItem('token');\n          localStorage.removeItem('user');\n          reject(err);\n        });\n      });\n    },\n    login: function login(_ref9, payload) {\n      var commit = _ref9.commit;\n      return new _Promise(function (resolve, reject) {\n        axios.post(api + '/auth/login/', {\n          username: payload.username,\n          password: {\n            hash: payload.password\n          }\n        }).then(function (res) {\n          // if (res.status === 200 && res.statusText === 'authenticated') {\n          if (res.status === 200) {\n            localStorage.setItem('token', res.data.token);\n            localStorage.setItem('user', _JSON$stringify(res.data.user));\n            axios.defaults.headers.common['Authorization'] = res.data.token;\n            commit('access_success', res.data);\n            resolve(res);\n          }\n        }).catch(function (err) {\n          var res = err.response;\n          commit('access_error');\n          localStorage.removeItem('token');\n          localStorage.removeItem('user');\n          reject(res);\n        });\n      });\n    },\n    getAllUsers: function getAllUsers(_ref10) {\n      var commit = _ref10.commit;\n      return new _Promise(function (resolve, reject) {\n        axios.get(api + '/users').then(function (res) {\n          console.log('USERS -> ', res.data);\n          commit('setUsers', res.data);\n          resolve(res.data);\n        }).catch(function (err) {\n          reject(err);\n        });\n      });\n    }\n  },\n  getters: {\n    getUsers: function getUsers(state) {\n      return state.users;\n    },\n    user: function user(state) {\n      return _typeof(state.user) !== 'object' ? JSON.parse(state.user) : state.user;\n    },\n    isLogged: function isLogged(state) {\n      return !!state.token;\n    },\n    authStatus: function authStatus(state) {\n      return state.status;\n    }\n  }\n};",{"version":3,"sources":["/home/desarrollo/Escritorio/unabasev4/src/store/modules/users.js"],"names":["axios","oldApi","api","lang","namespaced","state","users","Object","token","localStorage","getItem","user","JSON","parse","status","mutations","auth_request","access_success","payload","setUser","console","log","isObject","currency","attr","value","setItem","setUsers","access_error","register_error","verify_error","logout","actions","commit","resolve","reject","removeItem","defaults","headers","common","restart","post","then","res","catch","err","setPassword","id","newPassword","restartPassword","warn","data","register","verify","put","hash","message","validations","verifyAccount","notVerifyAccount","putUser","_id","businessType","length","google","auth","access_token","dispatch","response","googleNew","googleUser","login","username","password","getAllUsers","get","getters","getUsers","isLogged","authStatus"],"mappings":"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","sourcesContent":["import axios from 'axios'\nimport oldApi from '../../config/api'\nimport api from '../../lib/api'\nimport lang from '../../languages'\n// import { mapGetters } from 'vuex'\nexport default {\n  namespaced: true,\n  state: {\n    users: Object,\n    // user: Object,\n    token: typeof localStorage.getItem('token') !== 'undefined' &&\n      localStorage.getItem('token') !== 'undefined' ?\n      localStorage.getItem('token') : '',\n    user: typeof localStorage.getItem('user') !== 'undefined' &&\n      localStorage.getItem('user') !== 'undefined' ?\n      JSON.parse(localStorage.getItem('user')) : '',\n    status: ''\n  },\n  mutations: {\n    auth_request(state) {\n      state.status = 'loading'\n    },\n    access_success(state, payload) {\n      state.status = 'success'\n      state.user = {\n        ...payload.user\n      }\n      state.token = payload.token\n    },\n    setUser(state, payload) {\n      console.log(state.user);\n      if (payload.isObject) {\n        if (state.user.currency) {\n          console.log('etro en si ciurrency');\n          state.user[payload.attr] = payload.value //JSON.parse(JSON.stringify(payload.value))\n        } else {\n          console.log('etro en no ciurrency');\n\n          state.user[payload.attr] = payload.value //JSON.parse(JSON.stringify(payload.value))\n        }\n      } else {\n        if (payload.attr) {\n          state.user[payload.attr] = payload.value\n        } else {\n          localStorage.setItem('user', JSON.stringify(payload))\n          state.user = payload\n        }\n      }\n    },\n    setUsers(state, payload) {\n      state.users = payload\n    },\n    access_error(state) {\n      state.status = 'error'\n    },\n    register_error(state) {\n      state.status = 'error'\n    },\n    verify_error(state) {\n      state.status = 'error'\n    },\n    logout(state) {\n      state.status = ''\n      state.token = ''\n    }\n  },\n  actions: {\n    logout({\n      commit\n    }) {\n      // eslint-disable-next-line\n      return new Promise((resolve, reject) => {\n        commit('logout')\n        localStorage.removeItem('token')\n        localStorage.removeItem('user')\n        delete axios.defaults.headers.common['Authorization']\n        resolve()\n      })\n    },\n    restart({\n      commit\n    }, payload) {\n      return new Promise((resolve, reject) => {\n        axios\n          .post(api + '/users/restart/' + payload)\n          .then(res => {\n            resolve(res)\n          })\n          .catch(err => {\n            reject(err)\n          })\n      })\n    },\n    setPassword({\n      commit\n    }, payload) {\n      return new Promise((resolve, reject) => {\n        axios\n          .post(`${api}/auth/password/` + payload.id, {\n            newPassword: payload.newPassword,\n            restartPassword: true\n          })\n          .then(res => {\n            console.warn(res)\n\n            if (res.status === 200) {\n              localStorage.setItem('token', res.data.token)\n              localStorage.setItem('user', JSON.stringify(res.data.user))\n\n              axios.defaults.headers.common['Authorization'] = res.data.token\n              commit('access_success', res.data)\n              console.log('USUARIO -> ', res.data)\n              resolve(res)\n            }\n          })\n          .catch(err => {\n            reject(err)\n          })\n      })\n    },\n    register({\n      commit\n    }, payload) {\n      return new Promise((resolve, reject) => {\n        axios\n          .post(api + '/auth/register/', payload)\n          .then(res => {\n            // commit('register_success', res.data);\n            // localStorage.setItem('token', res.data.token);\n            // localStorage.setItem('user', JSON.stringify(res.data.user));\n            // axios.defaults.headers.common['Authorization'] = res.data.token;\n\n            resolve(payload.user)\n          })\n          .catch(err => {\n            commit('register_error')\n            localStorage.removeItem('token')\n            localStorage.removeItem('user')\n            reject(err)\n          })\n      })\n    },\n    verify: function ({\n      commit\n    }, payload) {\n      return new Promise((resolve, reject) => {\n        axios\n          .put(api + '/auth/verify/' + payload.id, {\n            hash: payload.hash\n          })\n          .then(res => {\n            if (res.status === 200) {\n              localStorage.setItem('token', res.data.token)\n              localStorage.setItem('user', JSON.stringify(res.data.user))\n\n              axios.defaults.headers.common['Authorization'] = res.data.token\n              commit('access_success', res.data)\n              // resolve(res);\n\n              resolve({\n                message: lang.validations.verifyAccount\n              })\n            }\n            // resolve({ message: lang.validations.verifyAccount });\n          })\n          .catch(err => {\n            commit('verify_error')\n            reject({\n              message: lang.validations.notVerifyAccount\n            })\n          })\n      })\n    },\n\n    putUser({\n      commit\n    }, payload) {\n      console.log(payload)\n      return new Promise((resolve, reject) => {\n        axios\n          .put(api + '/users' + '/' + payload._id, payload)\n          .then(res => {\n            localStorage.setItem('user', JSON.stringify(res.data))\n            if (payload.businessType && payload.businessType.length <= 0) {\n              commit('setUser', res.data)\n            }\n            resolve(res.data)\n          })\n          .catch(err => {\n            reject(err)\n          })\n      })\n    },\n\n    google({\n      commit\n    }, payload) {\n      return new Promise((resolve, reject) => {\n        console.log(api + '/auth/google')\n        axios\n          .post(oldApi.auth.google, {\n            token: payload.token,\n            access_token: payload.access_token,\n            google: payload.google\n          })\n          .then(data => {\n            localStorage.setItem('token', data.data.token)\n            localStorage.setItem('user', JSON.stringify(data.data.user))\n\n            axios.defaults.headers.common['Authorization'] = data.data.token\n            commit('access_success', data.data)\n\n            this.commit('currency/SET_CURRENCY', data.data.user.currency)\n            this.dispatch('business/getAllBusiness')\n            resolve(payload.user)\n          })\n          .catch(err => {\n            commit('access_error')\n            localStorage.removeItem('token')\n            localStorage.removeItem('user')\n            reject(err, err.response)\n          })\n      })\n    },\n    googleNew({\n      commit\n    }, payload) {\n      return new Promise((resolve, reject) => {\n        axios\n          .post(oldApi.auth.google.register, payload.googleUser)\n          .then(res => {\n            commit('access_success', res.data)\n            localStorage.setItem('token', res.data.token)\n            localStorage.setItem('user', JSON.stringify(res.data.user))\n\n            axios.defaults.headers.common['Authorization'] = res.data.token\n\n            resolve(payload.user)\n          })\n          .catch(err => {\n            commit('access_error')\n            localStorage.removeItem('token')\n            localStorage.removeItem('user')\n            reject(err)\n          })\n      })\n    },\n    login({\n      commit\n    }, payload) {\n      return new Promise((resolve, reject) => {\n        axios\n          .post(api + '/auth/login/', {\n            username: payload.username,\n            password: {\n              hash: payload.password\n            }\n          })\n          .then(res => {\n            // if (res.status === 200 && res.statusText === 'authenticated') {\n            if (res.status === 200) {\n              localStorage.setItem('token', res.data.token)\n              localStorage.setItem('user', JSON.stringify(res.data.user))\n\n              axios.defaults.headers.common['Authorization'] = res.data.token\n              commit('access_success', res.data)\n              resolve(res)\n            }\n          })\n          .catch(err => {\n            const res = err.response\n            commit('access_error')\n            localStorage.removeItem('token')\n            localStorage.removeItem('user')\n            reject(res)\n          })\n      })\n    },\n    getAllUsers({\n      commit\n    }) {\n      return new Promise((resolve, reject) => {\n        axios\n          .get(api + '/users')\n          .then(res => {\n            console.log('USERS -> ', res.data)\n            commit('setUsers', res.data)\n            resolve(res.data)\n          })\n          .catch(err => {\n            reject(err)\n          })\n      })\n    }\n  },\n  getters: {\n    getUsers: state => state.users,\n    user: state =>\n      typeof state.user !== 'object' ? JSON.parse(state.user) : state.user,\n    isLogged: state => !!state.token,\n    authStatus: state => state.status\n  }\n}\n"]}]}